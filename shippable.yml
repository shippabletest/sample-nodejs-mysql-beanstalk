language: node_js

node_js:
  - 0.10.25
  
services:
  - mysql

env:
  global:
    - XUNIT_FILE=shippable/testresults/result.xml
    - RDS_HOSTNAME=127.0.0.1 RDS_USERNAME=shippable RDS_PASSWORD="" RDS_DB_NAME=test RDS_PORT=3306
    - AWSAccessKeyId=AKIAIVJ3UKSBKXTXFGAA
    - secure: QV+FrBqgyIEtAWIHQ6See9WQbJ+iDwMxJHVD5B2iGpaZPYu51VElWTaKtJzqolyRA02LR4oXYm3zzduGhAsWlCq3xgtFUAogD6WG/O7GvfC6hHBSWeht7xy4PAt46kwqN8MofMcN7CjHVHHaZR3Z9g9uke9bX0SCPjJH4U97XY5cozw3OyNYsZx7ghDPow3R+BF15C6LrFVMIRvVdn4YVqLCwv8i9wMen4KqcZ454nk0w7wo5LoclZfFEPpJ92j+8+KKnE2ffhGBogDJuqRs/tOhRqRDiDKM6JruuoZL9uPkoErzRMOyhfUcJWWPUSoxp1NLRpeQglS9E0CBTLFZ6g==
  #  - secure: Vsb046P55cg84XEoTeD0NBPw64ll8vbvcye6109BK5kC54cIFptwAvUQezjcZgmPRdQVLnfkHzKB2sGslULyT0dendpia7C2yp+MighhwXOOir9+xgo5QqR3nddmSADcE2qWU9w5ZLWAuTb8FeYmIWKQo5RzA6uR0oKVb+dnOl6dfSP0vuAN9F81QBxmoQXDDXd6MgrxiM8FHKF2P1opIcIO8IwJIcoS5pVgYM9K3VrJNPRcZzQKrrkU0fR6ZK0l08JOxfBWvWM5LygfL6C7y5k1rGqWNABLI8TQxrURgFyUELXM1IJEXLXN/NtuUUy70w7FUqaUO6F7zO57lP75yw==
    #- secure: tD2cjFcQ6xqzxhBjqu2y8XIqyw5kbwd2IhhocYJYtHlBAxVATmL5VTaH8WlqKC5O5wzTujekVmhlJ5eNrmVa3kBqDxKd4Go+oELoM0crDBepSudRoVHd11ee+YRhsgCuj3tfXSR+bUJV9wBcvZBRcTwDs1Nz82zX45R3pQzMIQ0JbSTGIppXtonYCpw9yx1JUpMtOf6XwcXfnOyUKWGsE8Abj9AOZxQ0oGalEtdSbrBUIY8iwzV0j/VzijfZzRpAK23AvOZLVNlp0+JCK+5OFlSOgVn4KV9j6lFA4MpT4dBacYItXNOkLVpx5fxVfq+r6CE8YlQObv4V0nJWTf2wtw==

before_install:
  - SUDO=$(which sudo) && $SUDO pip install awsebcli

before_script: 
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - mysql -e 'create database if not exists test;'
  - mkdir -p ~/.aws
  - echo '[profile eb-cli]' > ~/.aws/config
  - echo "aws_access_key_id = $AWSAccessKeyId" >> ~/.aws/config
  - echo "aws_secret_access_key = $AWSSecretKey" >> ~/.aws/config

script:
  - mkdir -p .elasticbeanstalk
  - cp config.yml .elasticbeanstalk/
  - grunt

after_success:
  - ./node_modules/.bin/istanbul cover grunt -- -u tdd
  - ./node_modules/.bin/istanbul report cobertura --dir  shippable/codecoverage/
  - eb init 
  - eb deploy
